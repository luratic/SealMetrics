___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "SealMetrics",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/jpeg;base64,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\u003d\u003d"
  },
  "description": "Legally Robust Cookieless Analytics. Track 100% of your traffic and conversions without annoying cookie banners.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "RADIO",
    "name": "trackerType",
    "displayName": "Tracker type",
    "radioItems": [
      {
        "value": "gt",
        "displayValue": "Global Tracker"
      },
      {
        "value": "spt",
        "displayValue": "Super Privacy Tracker"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "account",
    "displayName": "Account ID",
    "simpleValueType": true,
    "help": "You can get it from the platform or is the value of \"oSm.account\" parameter from the code.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "event",
    "displayName": "Event type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "pageview",
        "displayValue": "Page view"
      },
      {
        "value": "conversion",
        "displayValue": "Conversion"
      },
      {
        "value": "microconversion",
        "displayValue": "Microconversion"
      }
    ],
    "simpleValueType": true,
    "help": "Event type you want to track."
  },
  {
    "type": "TEXT",
    "name": "label",
    "displayName": "Conversion or Microconversion name",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "event",
        "paramValue": "conversion",
        "type": "EQUALS"
      },
      {
        "paramName": "event",
        "paramValue": "microconversion",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "amount",
    "displayName": "Conversion value",
    "simpleValueType": true,
    "help": "You can add value to your conversion. Not mandatory.",
    "enablingConditions": [
      {
        "paramName": "event",
        "paramValue": "conversion",
        "type": "EQUALS"
      },
      {
        "paramName": "event",
        "paramValue": "microconversion",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "adin",
    "checkboxText": "Add \u0027_adin\u0027 parameter to URL",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "trackerType",
        "paramValue": "spt",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "config",
    "displayName": "Advanced Configuration",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "debug",
        "checkboxText": "Activate SealMetrics debug mode",
        "simpleValueType": true
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const injectScript = require('injectScript');
const copyFromWindow = require('copyFromWindow');
const callInWindow = require('callInWindow');
const setInWindow = require('setInWindow');
const createQueue = require('createQueue');
const trackerType = data.trackerType;
const amount = data.amount;
const adin = data.adin;
const debug = data.debug;

let oSm = copyFromWindow('oSm') || {};

oSm.account = data.account;
oSm.event = data.event;

if (debug) {
  oSm.debug = true;
}

if (data.event.indexOf('conversion') > -1) {
  oSm.label = data.label;
  if (amount) {
   oSm.amount = amount;
  }
}

if (trackerType === 'spt') {
  if (adin) {
    oSm.decore = 1;
  }
} else {
  oSm.use_session = 1;
}

setInWindow('oSm', oSm, true);

const getSmTrackerLoaded = () => {
  let smTrackerLoaded = copyFromWindow('smTrackerLoaded');
  if(smTrackerLoaded) {
    return smTrackerLoaded;
  }
  setInWindow('smTrackerLoaded', callInWindow('smTrackerLoaded')); 
  return copyFromWindow('smTrackerLoaded');
};

const onSuccess = () => {
  const smTrackerLoaded = getSmTrackerLoaded(); 
  var smTrackerEvent = copyFromWindow('sm.tracker.track');
  if (smTrackerEvent){
    smTrackerEvent(oSm.event);
    data.gtmOnSuccess();
  }
  else {
    onFailure();
  }
};
const onFailure = () => {
	log('Not Found SealMetrics Library');
  	data.gtmOnFailure();
};
const trackingUrl = 'https://app.sealmetrics.com/tag/tracker';
injectScript(trackingUrl, onSuccess, onFailure, 'smLib');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "oSm"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "smTrackerLoaded"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sm.tracker.track"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://app.sealmetrics.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 25/6/2024, 7:37:33


